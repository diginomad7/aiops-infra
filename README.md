# AIOps Infrastructure

Инфраструктура для автоматического обнаружения и устранения аномалий в микросервисных приложениях.

## Обзор

AIOps Infrastructure предоставляет комплексное решение для мониторинга, обнаружения аномалий и автоматического восстановления микросервисных приложений. Система использует методы машинного обучения для выявления отклонений в метриках и логах, а также автоматически применяет заранее определенные действия для устранения проблем.

### Ключевые компоненты

1. **Сбор метрик и логов**
   - Интеграция с Prometheus для сбора и анализа метрик
   - Интеграция с Loki для анализа логов приложений
   - Гибкая система запросов и фильтрации данных

2. **Обнаружение аномалий**
   - Детекторы на основе статистических методов
   - Детекторы на основе скользящего окна
   - Детекторы на основе алгоритма Isolation Forest
   - Анализ логов на основе шаблонов и частотного анализа

3. **Автоматическое восстановление**
   - Выполнение предопределенных действий по восстановлению
   - Интеграция с Kubernetes для операций масштабирования и перезапуска
   - Выполнение пользовательских скриптов
   - Отправка уведомлений в различные каналы

## Архитектура

![Архитектура](docs/images/architecture.png)

### Компоненты системы

- **Anomaly Detector** - ядро системы, анализирующее метрики и логи
- **Remediator** - компонент, выполняющий действия по восстановлению
- **API Server** - REST API для управления и мониторинга системы
- **Prometheus Collector** - сбор и анализ метрик из Prometheus
- **Loki Collector** - сбор и анализ логов из Loki
- **Action Handlers** - обработчики для различных типов действий

## Установка

### Предварительные требования

- Kubernetes кластер (v1.19+)
- Prometheus (v2.20+)
- Loki (v2.0+)
- Kubectl (v1.19+)

### Установка с помощью Helm

```bash
# Добавление Helm репозитория
helm repo add aiops https://your-repo/charts
helm repo update

# Установка с значениями по умолчанию
helm install aiops aiops/aiops-infra

# Установка с пользовательскими значениями
helm install aiops aiops/aiops-infra -f values.yaml
```

### Установка с помощью kubectl

```bash
# Клонирование репозитория
git clone https://github.com/diginomad7/aiops-infra.git
cd aiops-infra

# Применение манифестов
kubectl apply -f kubernetes/
```

## Конфигурация

### Общая конфигурация

Основная конфигурация системы находится в файле `configs/config.yaml`. Этот файл содержит настройки для различных компонентов системы.

### Настройка обнаружения аномалий метрик

Для настройки обнаружения аномалий в метриках используется файл `configs/prometheus_queries.yaml`. В этом файле определяются запросы к Prometheus, а также настройки детекторов для анализа полученных метрик.

### Настройка обнаружения аномалий в логах

Для настройки обнаружения аномалий в логах используется файл `configs/loki_patterns.yaml`. В этом файле определяются шаблоны для поиска в логах, а также настройки анализа частоты сообщений.

### Настройка действий по восстановлению

Действия по восстановлению настраиваются в файле `configs/config.yaml` в разделе `actions`. Каждое действие привязывается к определенному типу аномалии и содержит параметры для выполнения.

## Детекторы аномалий

### Детекторы для метрик Prometheus

Система поддерживает следующие типы детекторов для метрик:

1. **Statistical Detector** - использует статистические методы (среднее, стандартное отклонение)
2. **Window Detector** - использует скользящее окно для анализа данных
3. **Isolation Forest Detector** - использует алгоритм Isolation Forest для обнаружения выбросов

### Детекторы для логов Loki

Система поддерживает следующие методы анализа логов:

1. **Pattern Matching** - поиск заданных шаблонов в логах
2. **Frequency Analysis** - анализ частоты появления определенных типов сообщений
3. **Correlation Analysis** - анализ связей между разными типами сообщений

## API

Система предоставляет REST API для управления и мониторинга:

- `GET /api/v1/anomalies` - получение списка обнаруженных аномалий
- `GET /api/v1/detectors` - получение списка активных детекторов
- `POST /api/v1/detectors` - создание нового детектора
- `GET /api/v1/actions` - получение списка выполненных действий
- `POST /api/v1/actions` - ручное выполнение действия
- `GET /health` - проверка состояния системы
- `GET /metrics` - метрики Prometheus

## Примеры использования

### Мониторинг нагрузки на CPU

```yaml
# configs/prometheus_queries.yaml
queries:
  - name: cpu_usage
    query: 'avg by (instance) (irate(node_cpu_seconds_total{mode!="idle"}[5m]))'
    step: 1m
```

### Поиск ошибок в логах

```yaml
# configs/loki_patterns.yaml
patterns:
  - name: api_errors
    pattern: "ERROR.*API request failed"
    severity: high
    labels:
      - "app=api-service"
```

### Автоматическое масштабирование при высокой нагрузке

```yaml
# configs/config.yaml
actions:
  cpu_usage:
    type: kubernetes
    params:
      action: scale
      namespace: default
      deployment: api-deployment
      replicas: 5
```

## Вклад в проект

Вклады приветствуются! Пожалуйста, смотрите [CONTRIBUTING.md](CONTRIBUTING.md) для подробностей.

## Лицензия

[MIT](LICENSE)

## Контакты

- Email: miltonwelch4@gmail.com
- GitHub: [diginomad7](https://github.com/diginomad7) 
